<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PathFinder BFS</title>

<style>
:root {
  --bg: #0f172a;
  --panel: #020617;
  --text: #e5e7eb;
  --accent: #22c55e;
  --danger: #ef4444;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at top, #1e293b, var(--bg));
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: system-ui, sans-serif;
  color: var(--text);
}

.app {
  background: var(--panel);
  padding: 24px 28px;
  border-radius: 14px;
  box-shadow: 0 20px 40px rgba(0,0,0,.6);
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 24px;
}

/* CONTROLES */
.controls h1 {
  margin: 0 0 6px;
  font-size: 1.4rem;
}

.controls p {
  margin: 0 0 10px;
  opacity: .8;
  font-size: .9rem;
}

textarea {
  width: 100%;
  height: 120px;
  resize: none;
  padding: 10px;
  border-radius: 8px;
  border: none;
  outline: none;
  background: #020617;
  color: var(--text);
  font-family: monospace;
}

button {
  margin-top: 10px;
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: var(--accent);
  color: #022c22;
  font-weight: 600;
  cursor: pointer;
}

.slider {
  margin-top: 12px;
}

.slider label {
  display: flex;
  justify-content: space-between;
  font-size: .85rem;
  opacity: .9;
}

input[type="range"] {
  width: 100%;
}

.result {
  margin-top: 8px;
  font-weight: 600;
}

/* CANVAS */
.canvas-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
}

canvas {
  background: #fff;
  border-radius: 10px;
  border: 2px solid #020617;
}
</style>
</head>

<body>

<div class="app">

  <div class="controls">
    <h1>üß≠ PathFinder BFS</h1>
    <p>0 = obst√°culo ¬∑ 1 = camino</p>

<textarea id="matrix">
1 1 0
0 1 0
0 1 1
</textarea>

<button id="run">Evaluar camino</button>

<div class="slider">
  <label>
    <span>Velocidad</span>
    <span id="speedValue">400 ms</span>
  </label>
  <input id="speed" type="range" min="50" max="800" step="50" value="400">
</div>

<div class="result" id="result"></div>
  </div>

  <div class="canvas-wrapper">
    <canvas id="canvas" width="300" height="300"></canvas>
  </div>

</div>

<script type="module">
import init, { PathFinder } from "./pkg/challenger_soaint_wasm.js";
await init();

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const speedInput = document.getElementById("speed");
const speedValue = document.getElementById("speedValue");

speedValue.textContent = speedInput.value + " ms";
speedInput.oninput = () => {
  speedValue.textContent = speedInput.value + " ms";
};

document.getElementById("run").onclick = () => {
  const text = document.getElementById("matrix").value.trim();
  const rows = text.split("\n").map(r => r.trim().split(/\s+/).map(Number));
  const size = rows.length;
  const grid = rows.flat();

  const finder = new PathFinder(grid, size);

  drawGrid(rows);

  const result = document.getElementById("result");
  if (finder.has_path()) {
    result.textContent = "‚úÖ Existe un camino";
    result.style.color = "var(--accent)";
    animatePath(finder.path(), size);
  } else {
    result.textContent = "‚ùå No existe camino";
    result.style.color = "var(--danger)";
  }
};

function drawGrid(rows) {
  const size = rows.length;
  const cell = canvas.width / size;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for (let x = 0; x < size; x++) {
    for (let y = 0; y < size; y++) {
      ctx.fillStyle = rows[x][y] === 1 ? "#e5e7eb" : "#020617";
      ctx.fillRect(y * cell, x * cell, cell, cell);
      ctx.strokeRect(y * cell, x * cell, cell, cell);
    }
  }
}

function animatePath(flat, size) {
  const cell = canvas.width / size;
  let i = 0;

  function step() {
    if (i >= flat.length) return;

    const x = flat[i];
    const y = flat[i + 1];

    ctx.fillStyle = "#22c55e";
    ctx.fillRect(y * cell, x * cell, cell, cell);

    i += 2;
    setTimeout(step, Number(speedInput.value));
  }

  step();
}
</script>

</body>
</html>
